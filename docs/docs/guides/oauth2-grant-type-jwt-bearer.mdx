---
id: oauth2-grant-type-jwt-bearer
title: JSON Web Token (JWT) Profile (RFC7523)
---

Ory Hydra is capable of performing the
[JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants](https://tools.ietf.org/html/rfc7523).
This guide defines how a JWT Bearer Token can be used to request an access token
when a client wishes to utilize an existing trust relationship, expressed
through the semantics of the JWT, without a direct user-approval step at the
authorization server (Hydra).

## Requesting access token using JWT

To use a Bearer JWT as an authorization grant, the client uses an access token
request as defined in
[Section 4.1 of the OAuth Assertion Framework RFC7521](https://datatracker.ietf.org/doc/html/rfc7521#section-4.1)
with the following specific parameter values and encodings.

The value of the "grant_type" is "urn:ietf:params:oauth:grant-type:jwt-bearer".

The value of the "assertion" parameter MUST contain a single JWT.

The "scope" parameter may be used, as defined in the OAuth Assertion Framework
[RFC7521](https://datatracker.ietf.org/doc/html/rfc7521), to indicate the
requested scope.

Authentication of the client can be optional and is controlled by
`oauth2.grant.jwt.client_auth_optional` setting.

## JWT Requirements

1. The JWT MUST contain an "iss" (issuer) claim that contains a unique
   identifier for the entity that issued the JWT. Either client id or assertion
   server identifier.
2. The JWT MUST contain a "sub" (subject) claim identifying the principal that
   is the subject of the JWT (e.g. user email).
3. The JWT MUST contain an "aud" (audience) claim containing a value that
   identifies the authorization server (Hydra) as an intended audience. So this
   value must be Hydra Token URL.
4. The JWT MUST contain an "exp" (expiration time) claim that limits the time
   window during which the JWT can be used. Can be controlled by
   `oauth2.grant.jwt.max_ttl` setting.
5. The JWT MAY contain an "nbf" (not before) claim that identifies the time
   before which the token MUST NOT be accepted for processing by Hydra.
   Controlled by `oauth2.grant.jwt.jti_optional` setting.
6. The JWT MAY contain an "iat" (issued at) claim that identifies the time at
   which the JWT was issued. Controlled by `oauth2.grant.jwt.iat_optional` If
   "iat" is not passed, then current time (when assertion is received by Hydra)
   will be considered as issued date.
7. The JWT MAY contain a "jti" (JWT ID) claim that provides a unique identifier
   for the token. Controlled by `oauth2.grant.jwt.jti_optional` setting.
   **Note**: If "jti" is configured to be required, then Hydra will reject all
   assertions with the same "jti", if "jti" was already used by some assertion,
   and this assertion is not expired yet (see "exp" claim).
8. The JWT MUST be digitally signed.

## How Hydra checks assertion

So now we know what requirements are for JWT. But how Hydra knows if passed
assertion is valid and how Hydra checks it?

Last requirement in JWT requirements list is "The JWT MUST be digitally signed",
if Hydra **has** public key for the JWT assertion and key signature check, using
this public key, **passes**, then Hydra considers claims in this assertion as
**trusted** and will check them:

1. Hydra checks that "iss" (issuer) claim is presented and it is the same as
   issuer, registered for the public key (more on this later).
2. Hydra checks that "sub" (subject) claim is presented and it is the same as
   subject, registered for the public key (more on this later).
3. Hydra checks that "aud" (audience) claim is equal to Hydra Token URL.
4. Hydra calculates TTL for assertion based on "iat" claim and checks if TTL
   exceeds an "exp" (expiration time) claim.
5. If JWT contains an "nbf" (not before) claim, then Hydra checks the time,
   before which the token must no be accepted, is passed.
6. Hydra checks that "iat" (issued at) claim is presented if it is required.
7. Hydra checks that "jti" (JWT ID) claim is presented if it is required and is
   not in used already by another assertion.
8. If scopes were passed in request, then Hydra will check them against scope
   white list for current assertion ( see "Creating grant" below).

If every check is **passed**, Hydra will **issue** access token. But how to
register public key for assertion?

## Creating grant (registering public key)

In order to register public key for concrete issuer and subject we need to
create **Grant** using [Administrative Endpoints](../reference/api.mdx). Grant
creation can be expressed like: "User explicitly grants permission to represent
itself using using assertion for concrete issuer and subject using a pair of
keys, public one will be stored in Hydra to check signature".

During grant creation you can also set "scopes", this will serve as scope
whitelist, so assertions for this issuer and subject can only contain scopes
from this list or no scopes at all.

`expires_at` field in grant creation request sets grants max lifetime. If grant
expires, **no more** assertion for this issuer and subject will pass check.
